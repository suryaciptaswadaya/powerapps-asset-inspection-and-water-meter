scr_ReportScreen As screen:
    OnVisible: |
        =ClearCollect(c_TaskEngineering, Filter(c_Task,department_id = s_EngineeringDepartment));
        ClearCollect(c_TaskHouseKeeping, Filter(c_Task,department_id = s_HouseKeepingDepartment));
        ClearCollect(
            c_GroupedDataReport,
            AddColumns(
                c_TaskEngineering,
                "pic_name_2",LookUp(c_TaskHouseKeeping, assignment_code = c_TaskEngineering[@assignment_code], pic_name),
                "status_name_2",LookUp(c_TaskHouseKeeping, assignment_code = c_TaskEngineering[@assignment_code], status_name),
                "status_color_2",LookUp(c_TaskHouseKeeping, assignment_code = c_TaskEngineering[@assignment_code], status_color),
                "start_time_task_2",LookUp(c_TaskHouseKeeping, assignment_code = c_TaskEngineering[@assignment_code], start_time_task),
                "end_time_task_2",LookUp(c_TaskHouseKeeping, assignment_code = c_TaskEngineering[@assignment_code], end_time_task)
                
            )
        );
        
        Reset(dtp_TSTaskDate_1);
        Reset(dtp_TSTaskDate_2);
        Reset(ComboBox1);
        
        //ClearCollect(GroupedData, AddColumns(c_TaskEngineering,"pic_name_2",LookUp(c_TaskHouseKeeping,assignment_code = c_TaskEngineering[@assignment_code],pic_name)));

    cmp_RSBottomNavigation As cmp_MD_Bottom_Navigation_2:
        Height: =89
        iconSize: =34
        items: =c_NavigationMenu
        Y: =1046
        ZIndex: =1

    cmp_RSAppBar_top As cmp_MD_AppBar_top:
        onSelectIcon2: =Navigate(scr_NotificationScreen);
        svgIcon1: =""
        svgIcon2: |-
            ="<svg xmlns='http://www.w3.org/2000/svg' height='24' width='24'><path d='M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19M14,21A2,2 0 0,1 12,23A2,2 0 0,1 10,21'/></svg>"
        svgIcon3: =
        svgIcon4: =""
        titleText: ="Laporan"
        tooltipIcon2: =""
        tooltipIcon3: =""
        tooltipIcon4: =""
        ZIndex: =2

    ComboBox1 As combobox:
        BorderColor: =RGBA(12, 36, 47, 1)
        ChevronBackground: =RGBA(12, 36, 47, 1)
        DisplayFields: =["location_name"]
        Height: =50
        InputTextPlaceholder: ="Cari Lokasi"
        IsSearchable: =false
        Items: =c_AllLocation
        NoSelectionText: ="Filter Kamar"
        SearchFields: =["location_name"]
        SearchItems: =[]
        SelectMultiple: =false
        Size: =18
        Width: =595
        X: =22
        Y: =97
        ZIndex: =3

    icn_TSC_Line_1 As icon.HorizontalLine:
        Height: =55
        Icon: =Icon.HorizontalLine
        Width: =50
        X: =294
        Y: =167
        ZIndex: =4

    dtp_TSTaskDate_2 As datepicker:
        BorderColor: =defaults.borderColor
        BorderThickness: =defaults.inputBorderThickness
        CalendarHeaderFill: =defaults.primaryColor
        Color: =defaults.textColor
        DayColor: =defaults.primaryColor
        DefaultDate: =Date(Year(Today()),1,1)
        DisabledBorderColor: =defaults.disabledColor
        DisabledColor: =defaults.disabledColor
        DisabledFill: =defaults.elementBackgroundColor
        Fill: =defaults.inputFill
        FocusedBorderThickness: =2
        Font: =defaults.font
        Format: ="dd-mmm-yyyy"
        Height: =50
        HoverDateFill: =ColorValue(defaults.primaryColorTransparentHex)
        IconBackground: =Self.Fill
        IconFill: =defaults.primaryColor
        MonthColor: =defaults.primaryColor
        OnChange: =Set(d_TSV_Date, dtp_TSTaskDate_2.SelectedDate)
        OnSelect: =Set(d_TSV_Date, dtp_TSTaskDate_2.SelectedDate)
        PaddingLeft: =10
        PaddingTop: =5
        SelectedDateFill: =defaults.primaryColor
        Size: =18
        WeekColor: =defaults.primaryColor
        Width: =275
        X: =22
        Y: =172
        ZIndex: =5

    dtp_TSTaskDate_1 As datepicker:
        BorderColor: =defaults.borderColor
        BorderThickness: =defaults.inputBorderThickness
        CalendarHeaderFill: =defaults.primaryColor
        Color: =defaults.textColor
        DayColor: =defaults.primaryColor
        DisabledBorderColor: =defaults.disabledColor
        DisabledColor: =defaults.disabledColor
        DisabledFill: =defaults.elementBackgroundColor
        Fill: =defaults.inputFill
        FocusedBorderThickness: =2
        Font: =defaults.font
        Format: ="dd-mmm-yyyy"
        Height: =50
        HoverDateFill: =ColorValue(defaults.primaryColorTransparentHex)
        IconBackground: =Self.Fill
        IconFill: =defaults.primaryColor
        MonthColor: =defaults.primaryColor
        OnChange: =Set(d_TSV_Date, dtp_TSTaskDate_1.SelectedDate)
        OnSelect: =Set(d_TSV_Date, dtp_TSTaskDate_1.SelectedDate)
        PaddingLeft: =10
        PaddingTop: =5
        SelectedDateFill: =defaults.primaryColor
        Size: =18
        WeekColor: =defaults.primaryColor
        Width: =275
        X: =342
        Y: =172
        ZIndex: =6

    cmp_MD_GenericInputFrame_1 As cmp_MD_GenericInputFrame:
        Height: =806
        helperText: =""
        labelText: ="Laporan"
        Width: =640
        Y: =240
        ZIndex: =7

    DataTable2 As dataTable.datatable:
        BorderStyle: =BorderStyle.Solid
        DisplayMode: =DisplayMode.Edit
        Fill: =RGBA(0, 0, 0, 0)
        HeadingFill: =defaults.primaryColor
        HeadingSize: =18
        Height: =648
        Items: |-
            =If(IsBlank(ComboBox1.Selected.location_name),
                Filter(
                    ///*gila ini masa harus pake field awalnya sbelumnya time_task_pic1 jadi start_time_task*/
                    SortByColumns(c_GroupedDataReport,"location_name",SortOrder.Ascending,"time_task_pic1",SortOrder.Descending),
                    start_date >= dtp_TSTaskDate_2.SelectedDate,
                    start_date <= dtp_TSTaskDate_1.SelectedDate)
            ,
                Filter(
                /*gila ini masa harus pake field awalnya sbelumnya time_task_pic1 jadi start_time_task*/
                    SortByColumns(c_GroupedDataReport,"location_name",SortOrder.Ascending,"time_task_pic1",SortOrder.Descending),
                    start_date >= dtp_TSTaskDate_2.SelectedDate,
                    start_date <= dtp_TSTaskDate_1.SelectedDate,
                    location_name = ComboBox1.Selected.location_name)
            )
        Size: =16
        Width: =578
        X: =29
        Y: =275
        ZIndex: =9

        location_name_Column1 As dataTableColumn.textualColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Lokasi"
            FieldName: ="location_name"
            FieldVariantName: ="textualColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =1
            Text: =ThisItem.location_name
            Width: =135
            X: =-11
            Y: =0
            ZIndex: =9

        end_date_Column1 As dataTableColumn.textualColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Selesai"
            FieldName: ="end_date"
            FieldVariantName: ="textualColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =3
            Text: |-
                =If(IsBlank(ThisItem.end_time_task_2),"-",Text(ThisItem.end_time_task_2,"dd-mmm-yyyy hh:mm"))
            Width: =215
            X: =0
            Y: =0
            ZIndex: =10

        start_date_Column1 As dataTableColumn.textualColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Mulai"
            FieldName: ="start_date"
            FieldVariantName: ="textualColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =2
            Text: |-
                =If(IsBlank(ThisItem.start_time_task),"-", Text(ThisItem.start_time_task,"dd-mmm-yyyy hh:mm"))
            Width: =216
            X: =0
            Y: =0
            ZIndex: =11

        pic_name_Column1 As dataTableColumn.textualColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Engineering"
            FieldName: ="pic_name"
            FieldVariantName: ="textualColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =5
            Text: =ThisItem.pic_name
            Width: =186
            X: =0
            Y: =0
            ZIndex: =12

        pic_name_2_Column1 As dataTableColumn.textualColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Housekeeping"
            FieldName: ="pic_name_2"
            FieldVariantName: ="textualColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =7
            Text: =ThisItem.pic_name_2
            Width: =208
            X: =0
            Y: =0
            ZIndex: =13

        status_name_2_Column1 As dataTableColumn.textualColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Status"
            FieldName: ="status_name_2"
            FieldVariantName: ="textualColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =8
            Text: =ThisItem.status_name_2
            Width: =254
            X: =0
            Y: =0
            ZIndex: =15

        execution_time_Column1 As dataTableColumn.textualColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Execution Time"
            FieldName: ="approve_date"
            FieldVariantName: ="textualColumn"
            Height: =Parent.Height
            IsHyperlink: =false
            LayoutHeight: =Parent.Height
            Order: =4
            Text: |-
                =If(IsBlank(ThisItem.end_time_task_2), 
                "Belum Selesai",
                
                With(
                    {
                        days: RoundDown(DateDiff(ThisItem.start_time_task, ThisItem.end_time_task_2,TimeUnit.Hours) / 24, 0),
                        hours: Mod(RoundDown(DateDiff(ThisItem.start_time_task, ThisItem.end_time_task_2, TimeUnit.Minutes) / 60, 0), 24),
                        minutes: Mod(DateDiff(ThisItem.start_time_task, ThisItem.end_time_task_2,TimeUnit.Minutes), 60)
                    },
                    days & " hari, " & hours & " jam " & minutes & " menit"
                ))
            Width: =294
            X: =0
            Y: =0
            ZIndex: =16

    btn_RSExportData As button:
        Fill: =defaults.primaryColor
        Height: =52
        OnSelect: |-
            =Set(b_Continue, true);
            
            If(CountRows(Filter(c_GroupedDataReport, start_date >= dtp_TSTaskDate_2.SelectedDate, start_date <= dtp_TSTaskDate_1.SelectedDate/*,location_name = ComboBox1.Selected.location_name*/)) = 0,
                Set(b_Continue, false);
                Notify("Mohon lengkapi data terlebih dahulu");
            );
            
            If(b_Continue,
                Clear(c_DataExport);
                    If(IsBlank(ComboBox1.Selected.location_name),
                    ForAll(Filter(c_GroupedDataReport, start_date >= dtp_TSTaskDate_2.SelectedDate, start_date <= dtp_TSTaskDate_1.SelectedDate) As aCol,
                    
                    Collect(c_DataExport,
                    {
                        C1_Location : aCol.location_name,
                        C2_Start : aCol.start_time_task, 
                        C3_Finish : aCol.end_time_task_2, 
                        C5_PIC_Eng : aCol.pic_name,
                        C6_PIC_HK : aCol.pic_name_2, 
                        C7_Status : aCol.status_name,
                        //Status_HK : aCol.status_name_2
                        C4_Execution_Time : If(IsBlank(aCol.end_time_task_2), 
                                    "Belum Selesai",
                                    With(
                                        {
                                            days: RoundDown(DateDiff(aCol.start_time_task, aCol.end_time_task_2,TimeUnit.Hours) / 24, 0),
                                            hours: Mod(RoundDown(DateDiff(aCol.start_time_task, aCol.end_time_task_2, TimeUnit.Minutes) / 60, 0), 24),
                                            minutes: Mod(DateDiff(aCol.start_time_task, aCol.end_time_task_2,TimeUnit.Minutes), 60)
                                        },
                                        days & " hari, " & hours & " jam " & minutes & " menit"
                                ))
                    })
                );
            
                Set(
                    varExportFile,
                        "1_Lokasi" & "," & 
                        "2_Mulai" & "," & 
                        "3_Selesai" & "," & 
                        "4_Execution Time" & "," & 
                        "5_PIC Engineering" & "," & 
                        "6_PIC Housekeeping" & "," & 
                        "7_Status" & "," & 
                    Concat(
                        c_DataExport,
                        C1_Location & "," & 
                        C2_Start & "," & 
                        C3_Finish & "," & 
                        C4_Execution_Time& "," & 
                        C5_PIC_Eng & "," & 
                        C6_PIC_HK & "," & 
                        C7_Status & Char(10)
                    )
                );
                ,
                ForAll(Filter(c_GroupedDataReport, start_date >= dtp_TSTaskDate_2.SelectedDate, start_date <= dtp_TSTaskDate_1.SelectedDate,location_name = ComboBox1.Selected.location_name) As aCol,
                    Collect(c_DataExport,
                    {
                        C1_Location : aCol.location_name,
                        C2_Start : aCol.start_time_task, 
                        C3_Finish : aCol.end_time_task_2, 
                        C5_PIC_Eng : aCol.pic_name,
                        C6_PIC_HK : aCol.pic_name_2, 
                        C7_Status : aCol.status_name,
                        //Status_HK : aCol.status_name_2
                        C4_Execution_Time : If(IsBlank(aCol.end_time_task_2),
                                    "Belum Selesai",
                                    With(
                                        {
                                            days: RoundDown(DateDiff(aCol.start_time_task, aCol.end_time_task_2,TimeUnit.Hours) / 24, 0),
                                            hours: Mod(RoundDown(DateDiff(aCol.start_time_task, aCol.end_time_task_2, TimeUnit.Minutes) / 60, 0), 24),
                                            minutes: Mod(DateDiff(aCol.start_time_task, aCol.end_time_task_2,TimeUnit.Minutes), 60)
                                        },
                                        days & " hari, " & hours & " jam " & minutes & " menit"
                                ))
                    })
                );
            
                Set(
                    varExportFile,
                        "1_Lokasi" & "," & 
                        "2_Mulai" & "," & 
                        "3_Selesai" & "," & 
                        "4_Execution Time" & "," & 
                        "5_PIC Engineering" & "," & 
                        "6_PIC Housekeeping" & "," & 
                        "7_Status" & "," & 
                    Concat(
                        c_DataExport,
                        C1_Location & "," & 
                        C2_Start & "," & 
                        C3_Finish & "," & 
                        C4_Execution_Time& "," & 
                        C5_PIC_Eng & "," & 
                        C6_PIC_HK & "," & 
                        C7_Status & Char(10)
                    )
                );
                
                
            );
                Set(varFileLink,'ExportDataCSV-AssetInspection'.Run(JSON(c_DataExport, JSONFormat.IncludeBinaryData & JSONFormat.IgnoreUnsupportedTypes)).filelink);
                Notify("File saved to your One Drive. Please check your 'DataExport' folder on your One Drive");
            );
        Size: =20
        Text: ="Export"
        Width: =230
        X: =364
        Y: =945
        ZIndex: =10

